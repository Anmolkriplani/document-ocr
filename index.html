<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multilingual Document Understanding</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.10.111/build/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>
<body class="bg-gray-100 p-6">

<div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">üìÑ Multilingual Document Understanding</h1>
    
    <input type="file" id="fileInput" class="mb-4 border p-2 w-full" accept=".pdf,image/*">

    <button onclick="processDocument()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full">Process Document</button>

    <div id="loading" class="hidden text-center mt-4 text-gray-500">‚è≥ Processing... Please wait.</div>

    <h2 class="text-lg font-bold mt-6">Extracted JSON:</h2>
    <pre id="jsonOutput" class="bg-gray-100 p-4 rounded overflow-x-auto"></pre>
    
    <h2 class="text-lg font-bold mt-6">Extracted Markdown:</h2>
    <pre id="markdownOutput" class="bg-gray-100 p-4 rounded overflow-x-auto"></pre>

    <div class="mt-4 flex gap-4">
        <button onclick="downloadJSON()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-1/2">Download JSON</button>
        <button onclick="downloadMarkdown()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded w-1/2">Download Markdown</button>
    </div>
</div>

<script>
async function processDocument() {
    const fileInput = document.getElementById('fileInput');
    const loading = document.getElementById('loading');
    if (!fileInput.files.length) {
        alert("Please upload a file first.");
        return;
    }

    loading.classList.remove('hidden');

    const file = fileInput.files[0];
    let extractedText = "";

    if (file.type === "application/pdf") {
        extractedText = await extractFromPDF(file);
    } else if (file.type.startsWith("image/")) {
        extractedText = await extractFromImage(file);
    } else {
        alert("Unsupported file format.");
        loading.classList.add('hidden');
        return;
    }

    const jsonData = {
        language: "auto-detected",
        content: extractedText.trim()
    };

    const markdownData = `# Document Content\n\n${extractedText.trim()}`;

    document.getElementById('jsonOutput').textContent = JSON.stringify(jsonData, null, 2);
    document.getElementById('markdownOutput').textContent = markdownData;

    window._jsonData = jsonData;
    window._markdownData = markdownData;

    loading.classList.add('hidden');
}

async function extractFromPDF(file) {
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.10.111/build/pdf.worker.min.js";

    const arrayBuffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    let text = "";

    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const textContent = await page.getTextContent();
        text += textContent.items.map(item => item.str).join(" ") + "\n";
    }
    return text;
}

async function extractFromImage(file) {
    const { data: { text } } = await Tesseract.recognize(file, 'eng+hin+ara', {
        logger: m => console.log(m)
    });
    return text;
}

function downloadJSON() {
    if (!window._jsonData) {
        alert("Please process a file first.");
        return;
    }
    const blob = new Blob([JSON.stringify(window._jsonData, null, 2)], { type: "application/json" });
    saveAs(blob, "document.json");
}

function downloadMarkdown() {
    if (!window._markdownData) {
        alert("Please process a file first.");
        return;
    }
    const blob = new Blob([window._markdownData], { type: "text/markdown" });
    saveAs(blob, "document.md");
}
</script>

</body>
</html>
